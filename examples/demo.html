<!DOCTYPE html>
<html>
  <head>
    <title>WikiMate demo</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <meta content='width=device-width, height=device-height, initial-scale=1.0, user-scalable=no' name='viewport'>
    <link href='../public/stylesheets/wikimate.css' rel='stylesheet' type='text/css'>
    <script src='../public/javascripts/jquery-1.7.2.js' type='text/javascript'></script>
    <script src='../public/javascripts/jquery-ui-1.8.18.custom.min.js' type='text/javascript'></script>
    <script src='../public/javascripts/wikimate.js' type='text/javascript'></script>
    <script src='../public/javascripts/plugins/paragraph.js' type='text/javascript'></script>
    <script type='text/javascript'>
      $(document).ready(function() {
        var story = eval($('.store textarea').val());
        $('.wikimate').wikimate({story: story, change: function(event, action) {
          var data = eval($('.store textarea').val());
          if (action.type == 'add') {
            if (action.after) {
              var r = [];
              $.each(data, function(i, item) {
                r.push(item);
                if (item.id == action.after) {
                  r.push(action.item);
                }
              });
              data = r;
            } else {
              data.push(action.item);
            }
          } else if (action.type == 'edit') {
            $.each(data, function(i, item) {
              if (item.id == action.id) {
                item.text = action.item.text;
              }
            });
          } else if (action.type == 'remove') {
            var r = [];
            $.each(data, function(i, item) {
              if (item.id != action.id) {
                r.push(item);
              }
            });
            data = r;
          } else if (action.type == 'move') {
            data.sort(function(a, b) {
              return action.order.indexOf(a.id) - action.order.indexOf(b.id);
            });
          } else {
            alert("Unknown action type: " + action.type);
          }
          $('.store textarea').text(JSON.stringify(data));
        }});
      });
    </script>
    <style>
      p {
        margin: 1px;
      }
      .wikimate {
        width: 48%;
        height: 99%;
        min-height: 400px;
        float: left;
        border: 1px solid blue;
        padding: 5px;
      }
      textarea {
        width: 99%;
      }
      .store {
        width: 48%;
        min-height: 400px;
        height: 99%;
        float: right;
      }
      .store textarea {
        height: 99%;
        min-height: 400px;
      }
    </style>
  </head>
  <body>
    <header></header>
    <div class='main'>
      <div id='wiki' class='wikimate'>
      </div>
      <div class='store'>
        <textarea>
          [
            {"id":"43714eb542cffdc7","type":"paragraph","text":"sdf\nssssssddf\ndsf\ndsf\n"},
            {"id":"43714eb542cffdc4","type":"paragraph","text":"sdf\nsdf\ndsf\ndsf\nlkjafd\nasdfjlajsdf\nasdlfjalfd\nsadfjslaf\nsdf"},
            {"id":"43714eb542cffdc3","type":"paragraph","text":"sdf\nsdf\ndsdffdsff\ndsf\n"},
            {"id":"43714eb542cffdc2","type":"paragraph","text":"sdf\nsdf\ndsffff\ndsf\n"}
          ]
        </textarea>
      </div>
    </div>
    <footer class='login'>
    </footer>
  </body>
</html>
