<!DOCTYPE html>
<html>
  <head>
    <title>WikiMate demo</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <meta content='width=device-width, height=device-height, initial-scale=1.0, user-scalable=no' name='viewport'>
    <link href='../src/css/wikimate.css' rel='stylesheet' type='text/css'>
    <script src='../lib/diff.js' type='text/javascript'></script>
    <script src='../lib/underscore-1.3.1.js' type='text/javascript'></script>
    <script src='../lib/jquery-1.7.2.js' type='text/javascript'></script>
    <script src='../lib/jquery-ui-1.8.18.custom.min.js' type='text/javascript'></script>
    <script src='../src/js/base.js' type='text/javascript'></script>
    <script src='../src/js/story.js' type='text/javascript'></script>
    <script src='../src/js/text_editor.js' type='text/javascript'></script>
    <script src='../src/js/journal.js' type='text/javascript'></script>
    <script src='../src/js/undo.js' type='text/javascript'></script>
    <script src='../src/js/plugins/paragraph.js' type='text/javascript'></script>
    <script type='text/javascript'>
      var wiki = {
        "story": [
          {
            "type": "paragraph",
            "id": "7b56f22a4b9ee974",
            "text": "A wiki is a website whose users can add, modify, or delete its content via a web browser using a simplified markup language or a rich-text editor."
          },
          {
            "type": "paragraph",
            "id": "1a23f23b2b9ee974",
            "text": "Ward Cunningham, the developer of the first wiki software, WikiWikiWeb, originally described it as the simplest online database that could possibly work. Wiki (pronounced [ˈwiti] or [ˈviti]) is a Hawaiian word meaning fast or quick."
          },
          {
            "type": "paragraph",
            "id": "ee416d431ebf4fb4",
            "text": "WikiWikiWeb was the first wiki.[6] Ward Cunningham started developing WikiWikiWeb in Portland, Oregon, in 1994, and installed it on the Internet domain c2.com on March 25, 1995. It was named by Cunningham, who remembered a Honolulu International Airport counter employee telling him to take the Wiki Wiki Shuttle bus that runs between the airport's terminals."
          }
        ],
        "journal": [
          {
            "id": "7b56f22a4b9ee974",
            "type": "add",
            "item": {
              "text": "A wiki is a website whose users can add, modify, or delete its content via a web browser using a simplified markup language or a rich-text editor.",
              "id": "7b56f22a4b9ee974",
              "type": "paragraph"
            }
          },
          {
            "id": "ee416d431ebf4fb4",
            "type": "add",
            "item": {
              "text": "WikiWikiWeb was the first wiki.[6] Ward Cunningham started developing WikiWikiWeb in Portland, Oregon, in 1994, and installed it on the Internet domain c2.com on March 25, 1995.",
              "id": "ee416d431ebf4fb4",
              "type": "paragraph"
            }
          },
          {
            "id": "1a23f23b2b9ee974",
            "type": "add",
            "item": {
              "text": "Ward Cunningham, the developer of the first wiki software, WikiWikiWeb, originally described it as the simplest online database that could possibly work. Wiki (pronounced [ˈwiti] or [ˈviti]) is a Hawaiian word meaning fast or quick.",
              "id": "1a23f23b2b9ee974",
              "type": "paragraph"
            }
          },
          {
            "id": "ee416d431ebf4fb4",
            "type": "edit",
            "item": {
              "text": "WikiWikiWeb was the first wiki.[6] Ward Cunningham started developing WikiWikiWeb in Portland, Oregon, in 1994, and installed it on the Internet domain c2.com on March 25, 1995. It was named by Cunningham, who remembered a Honolulu International Airport counter employee telling him to take the Wiki Wiki Shuttle bus that runs between the airport's terminals.",
              "id": "ee416d431ebf4fb4",
              "type": "paragraph"
            }
          },
          {
            "id": "ef2982011019939f",
            "type": "add",
            "item": {
              "text": "hello world",
              "id": "ef2982011019939f",
              "type": "paragraph"
            }
          },
          {
            "id": "ef2982011019939f",
            "type": "remove"
          },
          {
            "id": "1a23f23b2b9ee974",
            "type": "move",
            "order": [
              "7b56f22a4b9ee974",
              "1a23f23b2b9ee974",
              "ee416d431ebf4fb4"
            ]
          }
        ]
      };
      function storyChanged(event, action) {
        var data = $.parseJSON($('#wiki-data').val()).story;
        if (action.type == 'add') {
          if (action.after) {
            var r = [];
            $.each(data, function(i, item) {
              r.push(item);
              if (item.id == action.after) {
                r.push(action.item);
              }
            });
            data = r;
          } else {
            data.push(action.item);
          }
        } else if (action.type == 'edit') {
          $.each(data, function(i, item) {
            if (item.id == action.id) {
              item.text = action.item.text;
            }
          });
        } else if (action.type == 'remove') {
          var r = [];
          $.each(data, function(i, item) {
            if (item.id != action.id) {
              r.push(item);
            }
          });
          data = r;
        } else if (action.type == 'move') {
          data.sort(function(a, b) {
            return action.order.indexOf(a.id) - action.order.indexOf(b.id);
          });
        } else {
          alert("Unknown action type: " + action.type);
        }

        var story = data
        var journal = $.map($('.wikimate-journal').find('.action'), function(action) {
          return $(action).data('data');
        });
        $('#wiki-data').val(JSON.stringify({story: story, journal: journal}));
      };
      $(document).ready(function() {
        $('#wiki-data').val(JSON.stringify(wiki));
        $('.wikimate').wikimate($.extend(wiki, {change: storyChanged})).wikimate('journal', wiki.journal);
        $('#undo').click(function(e) {
          $('.wikimate').wikimate('undo');
        });
      });
    </script>
    <style>
      p {
        margin: 1px;
      }
      .wikimate {
        width: 48%;
        height: 99%;
        min-height: 400px;
        float: left;
        border: 1px solid blue;
        padding: 5px;
      }
      textarea {
        width: 99%;
      }
      .store {
        width: 48%;
        min-height: 400px;
        height: 99%;
        float: right;
      }
      .store textarea {
        height: 99%;
        min-height: 200px;
      }
    </style>
  </head>
  <body>
    <header><input type='button' value='undo' id='undo'/></header>
    <div class='main'>
      <div id='wiki' class='wikimate'>
      </div>
      <div class='store'>
<textarea id='wiki-data'>
</textarea>
      </div>
    </div>
    <footer class='login'>
    </footer>
  </body>
</html>
